/* binking v2.0.0 | Get bank logo, colors, phone, brand, validation and etc. by card number | https://github.com/iserdmi/binking.git | by BinKing (https://binking.io) */
!function(){var c=function(e,r,a){var n=c._assign({},c.defaultResult),t=c._getOptionsAndCallback(r,a),o=t.options,i=t.callback;if(c._checkOptions(o,"Form"),n.cardNumberSource=e,n.cardNumberNormalized=c._getCardNumberNormalized(n.cardNumberSource),n.cardNumberValidByLuhn=c._isValidByLuhn(n.cardNumberNormalized),"archive"===o.strategy){if(6<=n.cardNumberNormalized.length){var s=c._getBankByCardNumber(n.cardNumberNormalized);c._appendResultWithArchiveBank(n,o,s)}if(c._appendResultWithBrand(n,o),o.sync)return n;if(i)i(n);else if(c._promiseSupported)return Promise.resolve(n)}else if(6<=n.cardNumberNormalized.length){var l={apiUrl:o.apiFormUrl,apiKey:o.apiKey,cardNumber:n.cardNumberNormalized.substr(0,6),sandbox:o.sandbox};if(i)c._apiRequest(l,function(e,r){r?console.error(r):c._appendResultByApiResponse(n,o,e),c._appendResultWithBrand(n,o),i(n)});else if(c._promiseSupported)return new Promise(function(a){c._apiRequest(l,function(e,r){r?console.error(r):c._appendResultByApiResponse(n,o,e),c._appendResultWithBrand(n,o),a(n)})})}else if(c._appendResultWithBrand(n,o),i)i(n);else if(c._promiseSupported)return Promise.resolve(n)};c.getBrand=function(e,r){var a=c._assign({},c.defaultOptions,r||{}),n=c._brands[e];if(!n)return null;var t=a.brandsLogosPath+n.alias+"-original.svg",o=a.brandsLogosPath+n.alias+"-inverted.svg";return c._assign({},n,{logoOriginalSvg:t,logoInvertedSvg:o})},c.getBrands=function(e,r){var a,n;n=e?c._isArray(e)?(a=e,r):(a=Object.keys(c._brands),e):(a=Object.keys(c._brands),{});for(var t=[],o=0;o<a.length;o++){var i=a[o],s=c.getBrand(i,n);s&&t.push(s)}return t},c.getBank=function(e,r,a){var n,t=c._getOptionsAndCallback(r,a),o=t.options,i=t.callback;if(c._checkOptions(o,"Bank"),"archive"===o.strategy){var s=c._banks[e];if(n=s?c._appendResultWithArchiveBank({},o,s):null,o.sync)return n;if(i)i(n);else if(c._promiseSupported)return Promise.resolve(n)}else{var l={apiUrl:o.apiBankUrl,apiKey:o.apiKey,bankAlias:e,sandbox:o.sandbox};if(i)c._apiRequest(l,function(e,r){r?(console.error(r),i(null)):(n=e?c._appendResultByApiResponse({},o,e):null,i(n))});else if(c._promiseSupported)return new Promise(function(a){c._apiRequest(l,function(e,r){r?(console.error(r),a(null)):(n=e?c._appendResultByApiResponse({},o,e):null,a(n))})})}},c.getBanks=function(o,e,r){var a=c._getOptionsAndCallback(e,r),i=a.options,t=a.callback;c._checkOptions(i,"Banks");var s,l=[];if("archive"===i.strategy){for(s=0;s<o.length;s++){var n=o[s],d=c._banks[n],u=d?c._appendResultWithArchiveBank({},i,d):null;l.push(u)}if(i.sync)return l;if(t)t(l);else if(c._promiseSupported)return Promise.resolve(l)}else{var g={apiUrl:i.apiBanksUrl,apiKey:i.apiKey,banksAliases:o.join(","),sandbox:i.sandbox};if(t)c._apiRequest(g,function(e,r){if(r){for(console.error(r),s=0;s<o.length;s++)l.push(null);t(l)}else{for(s=0;s<e.length;s++){var a=e[s],n=a?c._appendResultByApiResponse({},i,a):null;l.push(n)}t(l)}});else if(c._promiseSupported)return new Promise(function(t){c._apiRequest(g,function(e,r){if(r){for(console.error(r),s=0;s<o.length;s++)l.push(null);t(l)}else{for(s=0;s<e.length;s++){var a=e[s],n=a?c._appendResultByApiResponse({},i,a):null;l.push(n)}t(l)}})})}},c.getBrandLogo=function(e,r,a){var n=r||"original";return c._assign({},c.defaultOptions,a||{}).brandsLogosPath+e+"-"+n+".svg"},c.setDefaultOptions=function(e){c._assign(c.defaultOptions,e)},c.setValidationErrors=function(e){c._assign(c.validationErrors,e)},c.validationErrors={CARD_NUMBER_REQUIRED:"Indicate your bank card number",CARD_NUMBER_INVALID:"Card number contains invalid symbols",CARD_NUMBER_INCOMPLETE:"Card number entry is incomplete",CARD_NUMBER_OVERCOMPLETE:"Card number input exceeds allowable number of symbols",CARD_NUMBER_LUHN:"Card number entry contains typo",MONTH_REQUIRED:"Indicate card expiry date",MONTH_INVALID:"Error in card expiry date",YEAR_REQUIRED:"Indicate year of card expiry",YEAR_INVALID:"Error in year of card expiry",YEAR_IN_PAST:"Year of card expiry can not be in the past",MONTH_IN_PAST:"Month of card expiry can not be in the past",CODE_REQUIRED:"Please indicate security code",CODE_INVALID:"Security code is invalid"},c._isValidByLuhn=function(e){for(var r=0,a=!1,n=e.length-1;0<=n;n--){var t=e.charAt(n),o=parseInt(t,10);a&&9<(o*=2)&&(o-=9),r+=o,a=!a}return r%10==0},c.validateCardNumber=function(e){var r=e+"";if(!r)return c._makeValidationError("cardNumber","CARD_NUMBER_REQUIRED");if(/[^\d\s]+/.test(r))return c._makeValidationError("cardNumber","CARD_NUMBER_INVALID");var a=c._getCardNumberNormalized(r),n=c._getBrandByCardNumber(a),t=n?n.lengths[0]:12,o=n?n.lengths[n.lengths.length-1]:19;return a.length<t?c._makeValidationError("cardNumber","CARD_NUMBER_INCOMPLETE"):a.length>o?c._makeValidationError("cardNumber","CARD_NUMBER_OVERCOMPLETE"):c._isValidByLuhn(a)?void 0:c._makeValidationError("cardNumber","CARD_NUMBER_LUHN")},c.validateMonth=function(e){var r=e+"";if(!r)return c._makeValidationError("month","MONTH_REQUIRED");var a=parseInt(r);return!/^\d\d$/.test(r)||12<a||a<1?c._makeValidationError("month","MONTH_INVALID"):void 0},c.validateYear=function(e){var r=e+"";return r?/^\d\d$/.test(r)?void 0:c._makeValidationError("year","YEAR_INVALID"):c._makeValidationError("year","YEAR_REQUIRED")},c.validateDate=function(e,r){var a=parseInt(e),n=parseInt(r);if(!isNaN(a)&&!isNaN(n)){var t=new Date,o=t.getFullYear()%2e3,i=t.getMonth()+1;return n<o?c._makeValidationError("year","YEAR_IN_PAST"):o===n&&a<i?c._makeValidationError("month","MONTH_IN_PAST"):void 0}},c.validateCode=function(e){var r=e+"";return r?/^\d\d\d\d?$/.test(r)?void 0:c._makeValidationError("code","CODE_INVALID"):c._makeValidationError("code","CODE_REQUIRED")},c.validate=function(e,r,a,n){var t=!1,o={},i=c.validateCardNumber(e);i&&(o[i.field]=i,t=!0);var s=c.validateMonth(r);s&&(o[s.field]=s,t=!0);var l=c.validateYear(a);if(l&&(o[l.field]=l,t=!0),!s&&!l){var d=c.validateDate(r,a);d&&(o[d.field]=d,t=!0)}var u=c.validateCode(n);return u&&(o[u.field]=u,t=!0),{hasErrors:t,errors:o}},c._makeValidationError=function(e,r){return{field:e,code:r,message:c.validationErrors[r]}},c._checkOptions=function(e,r){if("archive"===e.strategy){if(!Object.keys(c._bins).length)throw new Error("BinKing: you should add banks by binking.addBanks(banks) to use archive strategy");if(!Object.keys(c._banks).length)throw new Error("BinKing: you should add bins by binking.addBins(bins) to use archive strategy")}else{if("api"!==e.strategy)throw new Error('BinKing: you should set option "strategy" to "api" or "archive"');if(e["api"+r+"Url"]===c["_defaultApi"+r+"Url"]&&!e.apiKey)throw new Error('BinKing: you should set option "apiKey" if you use api strategy with default api url')}},c.setDefaultResult=function(e){e.formBackgroundColor&&(c.defaultResult.formBackgroundColor=e.formBackgroundColor),e.formBackgroundColors&&(c.defaultResult.formBackgroundColors=e.formBackgroundColors,c.defaultResult.formBackgroundGradient=c._getGradient(["#eeeeee","#dddddd"],c.defaultOptions.gradientDegrees)),e.formBackgroundLightness&&(c.defaultResult.formBackgroundLightness=e.formBackgroundLightness),e.formTextColor&&(c.defaultResult.formTextColor=e.formTextColor),e.formBorderColor&&(c.defaultResult.formBorderColor=e.formBorderColor)},c._getOptionsAndCallback=function(e,r){var a=!e||c._isFunction(e)?{}:e;return{options:c._assign({},c.defaultOptions,a),callback:r||(c._isFunction(e)?e:null)}},c._banks={},c.addBanks=function(e){c._assign(c._banks,e)},c._bins={},c.addBins=function(e){c._assign(c._bins,e)},c._appendResultWithBrand=function(e,r){var a=c._getBrandByCardNumber(e.cardNumberNormalized);if(a){e.brandAlias=a.alias,e.brandName=a.name,e.brandLogoOriginalSvg=r.brandsLogosPath+a.alias+"-original.svg",e.brandLogoInvertedSvg=r.brandsLogosPath+a.alias+"-inverted.svg";var n=c._getFormBrandLogoBasename(e.brandAlias,r.brandLogoPolicy,e.formLogoScheme);e.formBrandLogoSvg=r.brandsLogosPath+n+".svg",e.codeName=a.codeName,e.codeMaxLength=a.codeMaxLength,e.codeMinLength=a.codeMinLength,e.cardNumberLengths=a.lengths,e.cardNumberMaxLength=a.lengths[a.lengths.length-1],e.cardNumberMinLength=a.lengths[0],e.cardNumberGaps=a.gaps}e.cardNumberBlocks=c._getBlocks(e.cardNumberGaps,e.cardNumberLengths),e.cardNumberMask=c._getMask(r.maskDigitSymbol,r.maskDelimiterSymbol,e.cardNumberBlocks),e.cardNumberNice=c._getNumberNice(e.cardNumberNormalized,e.cardNumberGaps)},c._appendResultWithArchiveBank=function(e,r,a){return a&&(c._assign(e,a),e.bankLogoBigOriginalSvg=r.banksLogosPath+a.bankAlias+"-big-original.svg",e.bankLogoBigInvertedSvg=r.banksLogosPath+a.bankAlias+"-big-inverted.svg",e.bankLogoSmallOriginalSvg=r.banksLogosPath+a.bankAlias+"-small-original.svg",e.bankLogoSmallInvertedSvg=r.banksLogosPath+a.bankAlias+"-small-inverted.svg",e.formBankLogoBigSvg=r.banksLogosPath+a.bankAlias+"-big-"+a.formLogoScheme+".svg",e.formBankLogoSmallSvg=r.banksLogosPath+a.bankAlias+"-small-"+a.formLogoScheme+".svg"),e.formBackgroundGradient=c._getGradient(e.formBackgroundColors,r.gradientDegrees),e},c._appendResultByApiResponse=function(e,r,a){return a&&c._assign(e,a),e.formBackgroundGradient=c._getGradient(e.formBackgroundColors,r.gradientDegrees),e},c._assign=function(){for(var e=arguments[0],r=1;r<arguments.length;r++){var a=arguments[r];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(a[n]instanceof Array?e[n]=c._assign([],a[n]):e[n]=a[n])}return e},c._getCardNumberNormalized=function(e){return(e+"").replace(/\D/g,"")},c._getBankByCardNumber=function(e){if(e.length<6)return null;var r=e.substr(0,6),a=c._bins[r];return a&&c._banks[a]||null},c._getGradient=function(e,r){return"linear-gradient("+r+"deg, "+e.join(", ")+")"},c._brands={visa:{name:"Visa",alias:"visa",pattern:/^4/,gaps:[4,8,12],lengths:[16,18,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},mastercard:{name:"Mastercard",alias:"mastercard",pattern:/^(51|52|53|54|55|22|23|24|25|26|27)/,gaps:[4,8,12],lengths:[16],codeName:"CVC",codeMinLength:3,codeMaxLength:3},"american-express":{name:"American Express",alias:"american-express",pattern:/^(34|37)/,gaps:[4,10],lengths:[15],codeName:"CID",codeMinLength:3,codeMaxLength:4},"diners-club":{name:"Diners Club",alias:"diners-club",pattern:/^(30|36|38|39)/,gaps:[4,10],lengths:[14,16,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},discover:{name:"Discover",alias:"discover",pattern:/^(60|64|65)/,gaps:[4,8,12],lengths:[16,19],codeName:"CID",codeMinLength:3,codeMaxLength:3},jcb:{name:"JCB",alias:"jcb",pattern:/^(18|21|35)/,gaps:[4,8,12],lengths:[16,17,18,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},unionpay:{name:"UnionPay",alias:"unionpay",pattern:/^(62)/,gaps:[4,8,12],lengths:[14,15,16,17,18,19],codeName:"CVN",codeMinLength:3,codeMaxLength:3},maestro:{name:"Maestro",alias:"maestro",pattern:/^(49|50|56|59|63|67)/,gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],codeName:"CVC",codeMinLength:3,codeMaxLength:3},mir:{name:"Mir",alias:"mir",pattern:/^(22)/,gaps:[4,8,12],lengths:[16,17,18,19],codeName:"CVP2",codeMinLength:3,codeMaxLength:3}},c._getBrandByCardNumber=function(e){if(!e)return null;var r=[];for(var a in c._brands)Object.prototype.hasOwnProperty.call(c._brands,a)&&c._brands[a].pattern.test(e)&&r.push(this._brands[a]);return 1===r.length?r[0]:null},c._isArray=function(e){return!!e&&"[object Array]"===Object.prototype.toString.call(e)},c._isFunction=function(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)},c._promiseSupported="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),c._getFormBrandLogoBasename=function(e,r,a){switch(r){case"auto":return e+"-"+(a||"original");case"inverted":return e+"-inverted";case"original":default:return e+"-original"}},c._getBlocks=function(e,r){for(var a=r[r.length-1],n=[],t=e.length-1;0<=t;t--){var o=a-e[t];a-=o,n.push(o)}return n.push(a),n.reverse()},c._getMask=function(e,r,a){for(var n="",t=0;t<a.length;t++)n+=(t?r:"")+Array(a[t]+1).join(e);return n},c._getNumberNice=function(e,r){for(var a=[0].concat(r).concat([e.length]),n=[],t=0;a[t]<e.length;t++){var o=a[t],i=Math.min(a[t+1],e.length);n.push(e.substring(o,i))}return n.join(" ")},c._buildUrl=function(e,r){var a=e,n=!0;for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&void 0!==r[t]&&(a+=(n?"?":"&")+t+"="+r[t],n=!1);return a},c._apiRequestsCount=0,c._savedApiResults={},c._request=function(e,a){var r=new c._XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){if(4===this.readyState){var e,r;try{e=JSON.parse(this.responseText)}catch(e){return r=new Error(this.responseText),a(null,r),!1}200!==this.status?(r=new Error("BinKing Api Error: "+e.message),a(null,r)):a(e)}},r.send()},c._apiRequest=function(e,a){var r=e.apiUrl,n=e.apiKey,t=e.cardNumber,o=e.bankAlias,i=e.banksAliases,s=e.sandbox,l=c._buildUrl(r,{apiKey:n,cardNumber:t,bankAlias:o,banksAliases:i,sandbox:s?1:void 0}),d=c._savedApiResults[l];if(d)if("pending"===d)var u=setInterval(function(){var e=c._savedApiResults[l];"pending"!==e&&(clearInterval(u),a(e[0],e[1]))},100);else a(d[0],d[1]);else c._apiRequestsCount++,c._savedApiResults[l]="pending",c._request(l,function(e,r){c._savedApiResults[l]=[e,r],a(e,r)})},c._XMLHttpRequest="undefined"!=typeof XMLHttpRequest?XMLHttpRequest:void 0,c._defaultApiFormUrl="https://api.binking.io/form",c._defaultApiBankUrl="https://api.binking.io/bank",c._defaultApiBanksUrl="https://api.binking.io/banks",c.defaultOptions={strategy:"api",apiFormUrl:c._defaultApiFormUrl,apiBankUrl:c._defaultApiBankUrl,apiBanksUrl:c._defaultApiBanksUrl,apiKey:void 0,sandbox:!1,sync:!1,banksLogosPath:"",brandsLogosPath:"https://static.binking.io/brands-logos/",maskDigitSymbol:"0",maskDelimiterSymbol:" ",gradientDegrees:135,brandLogoPolicy:"auto"},c.defaultResult={bankAlias:null,bankName:null,bankLocalName:null,bankCountry:null,bankSite:null,bankPhone:null,bankLogoBigOriginalSvg:null,bankLogoBigInvertedSvg:null,bankLogoSmallOriginalSvg:null,bankLogoSmallInvertedSvg:null,bankColor:null,bankColors:null,brandAlias:null,brandName:null,brandLogoOriginalSvg:null,brandLogoInvertedSvg:null,formBackgroundColor:"#eeeeee",formBackgroundColors:["#eeeeee","#dddddd"],formBackgroundGradient:c._getGradient(["#eeeeee","#dddddd"],c.defaultOptions.gradientDegrees),formBackgroundLightness:"light",formTextColor:"#000000",formBorderColor:"#333333",formBrandLogoSvg:null,formBankLogoBigSvg:null,formBankLogoSmallSvg:null,formLogoScheme:null,codeName:"CVV",codeMinLength:3,codeMaxLength:4,cardNumberMask:"0000 0000 0000 0000000",cardNumberGaps:[4,8,12],cardNumberBlocks:[4,4,4,7],cardNumberLengths:[12,13,14,15,16,17,18,19],cardNumberMaxLength:19,cardNumberMinLength:12,cardNumberValidByLuhn:!0,cardNumberNice:"",cardNumberNormalized:"",cardNumberSource:void 0},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.binking=c):"undefined"!=typeof window&&(window.binking=c)}();